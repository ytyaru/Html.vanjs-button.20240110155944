# VanFlickButton

　VanFlickButtonはVanButtonやVanSwitchButtonをベースとし、それらを中央から上下左右の４方向にサブボタンを表示し入力受付する。

```js
new VanFlickButton([
    new VanSwitchButton([[['白',true],['黒',false]], (value, text)=>{ this.themeColor.isLight = value; }])
    new VanSwitchButton([[['柔',true],['硬',false]], (value, text)=>{ this.themeColor.isSoft = value; }])
    new VanSwitchButton([[['青',true],['黄',false]], (value, text)=>{ this.themeColor.hasBlue = value; }])
])
```

　最初のボタンが中央のメインボタン、それ以降はサブボタンである。サブボタンは普段は非表示だが、マウスホバーやタッチ、フォーカスによって表示される。中央を中心に十字方向に分散表示される。ただし画面の端など配置によって可視方向へ密集することになる。

## サブボタン配置

　サブボタン配置は中央ボタンの配置場所によって変わる。画面を９つに分割したとき、それぞれの位置に中央ボタンがあるときの、サブボタン配置について考える。2〜4までの表示が可能だ。

```
□□□
□□□
□□□
```
```
１２３
４５６
７８９
```


□：なにもない
■：中央メインボタン
▲：サブボタン

### 2個

　四隅１・３・７・９は2個。

```
■▲□
▲□□
□□□
```

　斜めも含めたら3個まで表示できる。

### 3個

　四辺２・４・６・８は3個。
```
▲□□
■▲□
▲□□
```

　斜めも含めたら5個まで表示できる。

### 4個

　中央５は4個。

```
□▲□
▲■▲
□▲□
```

　斜めも含めたら8個まで表示できる。

### 問題

　ここで問題になるのは次の事柄だ。

* 表示しきれないサブボタンはどうする？
* 表示する方向と順序は？

#### 表示しきれないサブボタンはどうする？

A. 最少数２個にあわせてそれより多いサブボタンを与えることを禁止する
B. ４方向に限定するなら、配置できる方向に追加で残りのボタンを配置する
C. ８方向に増やして配置する

　なお、以下はボツである。

* 全方向が表示できるよう中央ボタン位置をずらす（混乱するのでNG。タッチの場合指で隠れて位置ずれが見えない）

##### A. 最少数２個にあわせてそれより多いサブボタンを与えることを禁止する

　メイン1、サブ1〜2つのみ許可する。それ以上はエラー。じつにシンプル。

```js
new VanFlickButton([new Button(), new Button()])
new VanFlickButton([new Button(), new Button(), new Button()])
```

##### B. ４方向に限定するなら、配置できる方向に追加で残りのボタンを配置する

　メイン1、サブ1〜4つのみ許可する。

```js
new VanFlickButton([new Button(), new Button(), new Button(), new Button(), new Button()])
```

　表示できない方向があるときは、表示可能方向に延長して他のボタンを配置する。

```
■▲▲
▲□□
▲□□
```
```
▲□□
■▲▲
▲□□
```

##### C. ８方向に増やして配置する

　メイン1、サブ1〜8つのみ許可する。

```js
new VanFlickButton([new Button(), new Button(), new Button(), new Button(), new Button(), new Button(), new Button(), new Button(), new Button()])
```

```
■▲▲
▲▲▲
▲▲▲
```
```
▲▲▲
■▲▲
▲▲▲
```
```
▲▲▲
▲■▲
▲▲▲
```

#### 表示する方向と順序は？

　シンプルに固定にしたいが、配置位置によって可変になるはず。

　たとえば表示方向と順序を、時計12時方向開始で、時計回りと考えてみる。

```
　①
④■②
　③
```

　このとき四隅に配置されたらどうなるか。

```
■②□
③□□
□□□
```
```
□□□
□□①
□④■
```
```
□④■
□□③
□□□
```
```
□□□
①□□
■②□
```

　配置可能方向のうち、若い番号順から配置すればいい。

　たとえば左上四隅で4方向に限るとき、方向②、③の２方向のみに限定される。このとき配置位置は相対的にposでインクリメントされていく。

```
subButtons: [
    {button: ..., dir:2, pos:0 }
    {button: ..., dir:3, pos:0 }
    {button: ..., dir:2, pos:1 }
    {button: ..., dir:3, pos:1 }
    {button: ..., dir:2, pos:2 }
    {button: ..., dir:3, pos:2 }
]
```

　具体的なHTML上での座標は次のように取得すればいい。

```js
subButtons[0].button.element.getBoundingClientRect()
```

　あとは方向数を８に増やしても同じ。

```
⑧①②
⑦■③
⑥⑤④
```

　このとき四隅に配置されたらどうなるか。

```
■③□
⑤④□
□□□
```
```
□□□
□⑧①
□⑦■
```
```
□⑦■
□⑥⑤
□□□
```
```
□□□
①②□
■③□
```

　ここで気になる点がある。以下のように左上四隅に配置したとき、サブボタンが２つしかなければ、③④に配置される。その配置が悪い。③⑤で配置したほうがミスタッチを減らせる。

```
■③□
⑤④□
□□□
```

```
■③□
□④□
□□□
```

```
■③□
⑤□□
□□□
```

　つまり８方向のときは単純な時計回りではなく、４方向の時計回りを２組つくり組み合わせる感じで、以下のようにする。

```
⑧①⑤
④■②
⑦③⑥
```

　これを左上四隅に配置した場合は次のようになる。

```
■②□
③⑥□
□□□
```
```
□□□
□⑧①
□④■
```
```
□④■
□⑦③
□□□
```
```
□□□
①⑤□
■②□
```

　これを番号の若い順に配置すれば、なるだけミスタッチしづらい配置にできる。

　数が増えた場合は、この配置をさらに外側に作っていく。


```
　　⑨　　
　⑧①⑤
⑫④■②⑩
　⑦③⑥
　　⑪　　
```

```
⑯　⑨　⑬
　⑧①⑤
⑫④■②⑩
　⑦③⑥
⑮　⑪　⑭
```

```
⑯　⑨⑰⑬
⑳⑧①⑤
⑫④■②⑩
　⑦③⑥⑱
⑮⑲⑪　⑭
```
```
⑯㉔⑨⑰⑬
⑳⑧①⑤㉑
⑫④■②⑩
㉓⑦③⑥⑱
⑮⑲⑪㉒⑭
```

　これを左上四隅に配置した場合は次のようになる。なるだけ各方向に分散する順序で配置される。

```
■②⑩
③⑥⑱
⑪㉒⑭
```
```
⑯㉔⑨
⑳⑧①
⑫④■
```
```
⑫④■
㉓⑦③
⑮⑲⑪
```
```
⑨⑰⑬
①⑤㉑
■②⑩
```

* なるだけ中央に隣接させる
* なるだけ各方向に分散させる

　これでなるだけコンパクトかつミスタッチの少ないサブボタン配置ができる。

