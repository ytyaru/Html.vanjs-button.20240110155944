# VanFlickButton

　VanFlickButtonはVanButtonやVanSwitchButtonをベースとし、それらを中央から上下左右の４方向にサブボタンを表示し入力受付する。

```js
new VanFlickButton([
    new VanSwitchButton([[['白',true],['黒',false]], (value, text)=>{ this.themeColor.isLight = value; }])
    new VanSwitchButton([[['柔',true],['硬',false]], (value, text)=>{ this.themeColor.isSoft = value; }])
    new VanSwitchButton([[['青',true],['黄',false]], (value, text)=>{ this.themeColor.hasBlue = value; }])
])
```

　最初のボタンが中央のメインボタン、それ以降はサブボタンである。サブボタンは普段は非表示だが、マウスホバーやタッチ、フォーカスによって表示される。中央を中心に十字方向に分散表示される。ただし画面の端など配置によって可視方向へ密集することになる。

## サブボタン配置

　サブボタン配置は中央ボタンの配置場所によって変わる。画面を９つに分割したとき、それぞれの位置に中央ボタンがあるときの、サブボタン配置について考える。2〜4までの表示が可能だ。

```
□□□
□□□
□□□
```
```
１２３
４５６
７８９
```


□：なにもない
■：中央メインボタン
▲：サブボタン

### 2個

　四隅１・３・７・９は2個。

```
■▲□
▲□□
□□□
```

　斜めも含めたら3個まで表示できる。

### 3個

　四辺２・４・６・８は3個。
```
▲□□
■▲□
▲□□
```

　斜めも含めたら5個まで表示できる。

### 4個

　中央５は4個。

```
□▲□
▲■▲
□▲□
```

　斜めも含めたら8個まで表示できる。

### 問題

　ここで問題になるのは次の事柄だ。

* 表示しきれないサブボタンはどうする？
* 表示する方向と順序は？

#### 表示しきれないサブボタンはどうする？

A. 最少数２個にあわせてそれより多いサブボタンを与えることを禁止する
B. ４方向に限定するなら、配置できる方向に追加で残りのボタンを配置する
C. ８方向に増やして配置する

　なお、以下はボツである。

* 全方向が表示できるよう中央ボタン位置をずらす（混乱するのでNG。タッチの場合指で隠れて位置ずれが見えない）

##### A. 最少数２個にあわせてそれより多いサブボタンを与えることを禁止する

　メイン1、サブ1〜2つのみ許可する。それ以上はエラー。じつにシンプル。

```js
new VanFlickButton([new Button(), new Button()])
new VanFlickButton([new Button(), new Button(), new Button()])
```

##### B. ４方向に限定するなら、配置できる方向に追加で残りのボタンを配置する

　メイン1、サブ1〜4つのみ許可する。

```js
new VanFlickButton([new Button(), new Button(), new Button(), new Button(), new Button()])
```

　表示できない方向があるときは、表示可能方向に延長して他のボタンを配置する。

```
■▲▲
▲□□
▲□□
```
```
▲□□
■▲▲
▲□□
```

##### C. ８方向に増やして配置する

　メイン1、サブ1〜8つのみ許可する。

```js
new VanFlickButton([new Button(), new Button(), new Button(), new Button(), new Button(), new Button(), new Button(), new Button(), new Button()])
```

```
■▲▲
▲▲▲
▲▲▲
```
```
▲▲▲
■▲▲
▲▲▲
```
```
▲▲▲
▲■▲
▲▲▲
```

#### 表示する方向と順序は？

　シンプルに固定にしたいが、配置位置によって可変になるはず。

　たとえば表示方向と順序を、時計12時方向開始で、時計回りと考えてみる。

```
　①
④■②
　③
```

　このとき四隅に配置されたらどうなるか。

```
■②□
③□□
□□□
```
```
□□□
□□①
□④■
```
```
□④■
□□③
□□□
```
```
□□□
①□□
■②□
```

　配置可能方向のうち、若い番号順から配置すればいい。

　たとえば左上四隅で4方向に限るとき、方向②、③の２方向のみに限定される。このとき配置位置は相対的にposでインクリメントされていく。

```
subButtons: [
    {button: ..., dir:2, pos:0 }
    {button: ..., dir:3, pos:0 }
    {button: ..., dir:2, pos:1 }
    {button: ..., dir:3, pos:1 }
    {button: ..., dir:2, pos:2 }
    {button: ..., dir:3, pos:2 }
]
```

　具体的なHTML上での座標は次のように取得すればいい。

```js
subButtons[0].button.element.getBoundingClientRect()
```

　あとは方向数を８に増やしても同じ。

```
⑧①②
⑦■③
⑥⑤④
```

　このとき四隅に配置されたらどうなるか。

```
■③□
⑤④□
□□□
```
```
□□□
□⑧①
□⑦■
```
```
□⑦■
□⑥⑤
□□□
```
```
□□□
①②□
■③□
```

　ここで気になる点がある。以下のように左上四隅に配置したとき、サブボタンが２つしかなければ、③④に配置される。その配置が悪い。③⑤で配置したほうがミスタッチを減らせる。

```
■③□
⑤④□
□□□
```

```
■③□
□④□
□□□
```

```
■③□
⑤□□
□□□
```

　つまり８方向のときは単純な時計回りではなく、４方向の時計回りを２組つくり組み合わせる感じで、以下のようにする。

```
⑧①⑤
④■②
⑦③⑥
```

　これを左上四隅に配置した場合は次のようになる。

```
■②□
③⑥□
□□□
```
```
□□□
□⑧①
□④■
```
```
□④■
□⑦③
□□□
```
```
□□□
①⑤□
■②□
```

　これを番号の若い順に配置すれば、なるだけミスタッチしづらい配置にできる。

　数が増えた場合は、この配置をさらに外側に作っていく。


```
　　⑨　　
　⑧①⑤
⑫④■②⑩
　⑦③⑥
　　⑪　　
```

```
⑯　⑨　⑬
　⑧①⑤
⑫④■②⑩
　⑦③⑥
⑮　⑪　⑭
```

```
⑯　⑨⑰⑬
⑳⑧①⑤
⑫④■②⑩
　⑦③⑥⑱
⑮⑲⑪　⑭
```
```
⑯㉔⑨⑰⑬
⑳⑧①⑤㉑
⑫④■②⑩
㉓⑦③⑥⑱
⑮⑲⑪㉒⑭
```

　これを左上四隅に配置した場合は次のようになる。なるだけ各方向に分散する順序で配置される。

```
■②⑩
③⑥⑱
⑪㉒⑭
```
```
⑯㉔⑨
⑳⑧①
⑫④■
```
```
⑫④■
㉓⑦③
⑮⑲⑪
```
```
⑨⑰⑬
①⑤㉑
■②⑩
```

* なるだけ中央に隣接させる
* なるだけ各方向に分散させる
* 中央を含め各方向３つ以内に抑える

　これでなるだけコンパクトかつミスタッチの少ないサブボタン配置ができる。これ以上に多くのボタンが欲しいときはVanFlickButton以外を使うべき。

　ここで重要なのは各ボタンの大きさを同じ正方形に固定すること。これで同じ間隔で操作できる。もし中央ボタンとサブボタンのサイズが違えば、さらに複雑な配置を求められる。

### 中央とサブのサイズが違う場合

```
   S1 S2 S3
S8 中央ボタン S4
   S7 S6 S5
```

　さらにwriting-modeによる違いも要検討。

```
   S1
SC 中 S2
SB 央 S3
SA ボ S4
S9 タ S4
S8 ン S6
   S7
```

　つまり方向と配置数だけでなく、面積で判断せねばならない。各ボタンのサイズが違うと、その配置算出は非常に複雑化する。

　考えたくないが、各方向の面積比をなるだけ等分しつつ隙間なく埋めるため、矩形以外の形状にすることすら考えられる。

```
+-----+++-----
|     ||     |
|  +--++--+  |
|  |      |  |
+--+      +--+
+--+      +--+
|  |      |  |
|  +--++--+  |
|     ||     |
+-----+++-----
```

　矩形以外になると中に入れるテキストの表示をどうするか、という問題も出てくる。書字方向writing-modeがコロコロ変わりそう。読みにくそう。

　もういっそ、円形にしてしまうか。テキストもパスに沿って配置させるか。非常に見づらいUIになりそう。

　左端四隅に３つのサブボタンがある場合。サブボタンは左右逆L字になっており、三等分される。さらに中央ボタンが円形ならそれに沿った形で扇形になる。円グラフみたいな感じ。やはり問題は書字方向。

```
+------+--+
|      |  |
|      |  |
|      +--+
|      |  |
+------+  |
|      |  |
+------+--+
```

　やはりテキストは一字のアイコン・ピクトグラムにして、矩形配置するのが最善。



　とはいえ、中央ボタンのみ複数字によるボタンにし、サブボタンは一字のみにしたい場合もありそう。この場合、どう要件に答えるか。

　縦横を中央ボタンと同じに揃えてしてしまえば単純化できるか？

```
   +----------+
   |    S1    |  
+--+----------+--+ 
|S4|中央ボタン|S2|
+--+----------+--+
   |    S3    |
   +----------+
```

```
   +--+
   |S1|
+--+--+--+
|  |中|  |
|  |央|  |
|S4|ボ|S2|
|  |タ|  |
|  |ン|  |
+--+--+--+
   |S3|
   +--+
```

　問題が複数ある。

* 方向によるボタンサイズ比が大きく違ってしまう
* それをなるだけ調整するために順番を変更したい（面積が広いほうを先に表示したい）

　いっそ長辺が含まれる方向のみに限定したほうが早いか。たとえ四隅であろうと必ず長辺を含む方向は一つある。

　たとえば左上四隅の縦書きなら右のみ、下は使わない。左上四隅の横書きなら下のみ、右は使わない。

```
+--+--+--+
|中|  |  |
|央|  |  |
|ボ|S1|S2|
|タ|  |  |
|ン|  |  |
+--+--+--+
```
```
+----------+
|中央ボタン|
+----------+
|    S1    |
+----------+
|    S2    |
+----------+
```

　中央配置の横書きなら上下のみ、左右は使わない。


```
+----------+
|    S2    |
+----------+
|    S1    |
+----------+
|中央ボタン|
+----------+
|    S2    |
+----------+
|    S4    |
+----------+
```

　中央配置の縦書きなら左右のみ、上下は使わない。

```
+--+--+--+--+--+
|  |  |中|  |  |
|  |  |央|  |  |
|S4|S2|ボ|S1|S3|
|  |  |タ|  |  |
|  |  |ン|  |  |
+--+--+--+--+--+
```

　ただしサブボタンのサイズは、表示可能方向数と合計サブボタン数によっては半分にしたい。

```
+--+--+--+--+--+
|S8|S4|中|S1|S5|
|  |  |央|  |  |
+--+--+ボ+--+--+
|S6|S2|タ|S3|S7|
|  |  |ン|  |  |
+--+--+--+--+--+
```
```
+----------+
|S5  |S7   |
+----------+
|S1  |S3   |
+----+-----+
|中央ボタン|
+----+-----+
|S4  |S2   |
+----------+
|S8  |S6   |
+----------+
```

　配置位置によっては表示可能方向数が１だけの場合もある。

```
+--+--+--+--+--+
|中|S1|S3|S5|S7|
|央|  |  |  |  |
|ボ+--+--+--+--+
|タ|S2|S4|S6|S8|
|ン|  |  |  |  |
+--+--+--+--+--+
```
```
+----+-----+
|S7  |S8   |
+----------+
|S5  |S6   |
+----------+
|S3  |S4   |
+----------+
|S1  |S2   |
+----+-----+
|中央ボタン|
+----------+
```

```
+--+--+--+--+
|中|S1|S3|S6|
|央|  +--+--|
|ボ+--|S4|S7|
|タ|S2+--+--|
|ン|  |S5|S8|
+--+--+--+--+
```
```
+----------+
|S6| S7 |S8|
+--+----+--+
|S3| S4 |S5|
+--+----+--+
|S1   |S2  |
+-----+----+
|中央ボタン|
+----------+
```

```
+--+--+--+
|  |S1|S5|
|中+--+--+
|央|S2|S6|
|ボ+--+--+
|タ|S3|S7|
|ン+--+--+
|  |S4|S8|
+--+--+--+
```
```
+--+--+--+--+
|S5|S6|S7|S8|
+--+--+--+--+
|S1|S2|S3|S4|
+-----+-----+
|中央ボタン |
+-----------+
```

　もしサブメニューのほうが中央ボタンより長ければテキストを「…」で縮める。マウスオーバーやフォーカスで全文をチップス表示する。






サブ数|長比|配置方向数
------|----|----------
1〜2|1  |1〜2
3〜4|0.5|1〜2
5〜8|0.5|3〜4

数|配置方向数|長比
--|----------|----
1|1
2|1
3|1
4|1
5|1
6|1
7|1
8|1

